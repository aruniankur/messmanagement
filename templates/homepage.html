<!DOCTYPE html>
<html>
  <head>
    <title>Home Page</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <style>
      body {
        background-image: url("{{ url_for("static", filename="images/bg2.svg") }}");
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
        background-attachment: fixed;
        min-height: 100vh; /* Ensure the background covers the entire viewport height */
      }

      .horizontalnavbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        color: black; /* Set text color to white for better contrast */
        width: 100%;
        position: fixed; /* Fix the navbar */
        top: 0; /* Position it at the top */
        left: 0; /* Align it to the left */
        z-index: 1000;
        background: linear-gradient(
          yellow 60%,
          rgba(0, 0, 0, 0)
        ); /* Gradient background */
      }

      .left-section,
      .right-section {
        display: flex;
        align-items: center;
      }

      .logo-image {
        margin-right: 10px;
        margin-left: 10px;
      }

      .logo-image,
      h1,
      h2,
      h3 {
        font-family: "Arial", sans-serif;
        font-size: 3rem;
      }

      .horizontalnavbar a {
        color: black;
        text-decoration: none;
        transition: color 0.3s;
      }

      .horizontalnavbar a:hover {
        color: #ffd700;
      }

      .verticalnavbar {
        backdrop-filter: blur(15px) saturate(180%);
        -webkit-backdrop-filter: blur(15px) saturate(180%);
        background-color: rgba(17, 25, 40, 0.75);
        border: 1px solid rgba(255, 255, 255, 0.125);
        height: 100vh;
        padding: 20px;
        position: fixed;
        left: 0;
        top: 13vh;
        border-top-right-radius: 40px;
        color: white;
        width: 20%;
        padding: 25px;
        box-shadow: 2px 0px 5px rgba(0, 0, 0, 0.2);
      }

      .verticalnavbar h1 {
        font-size: 2rem;
        margin-bottom: 20px;
        text-align: center;
      }

      .verticalnavbar ul {
        list-style: none;
        padding: 0;
      }

      .verticalnavbar li {
        margin-bottom: 10px;
        font-size: 1.2rem;
      }

      .verticalnavbar a {
        color: white;
        text-decoration: none;
        display: inline-block;
        padding: 8px 12px;
      }

      .verticalnavbar a:hover {
        color: #ffd700;
        background-color: #333;
        border-radius: 12px;
      }

      .verticalnavbar ul {
        list-style-type: none;
        padding: 0;
      }

      .verticalnavbar li {
        margin-bottom: 10px;
      }

      .verticalnavbar a {
        text-decoration: none;
        color: #fff;
      }

      .datacontainer {
        margin-left: 21%;
        margin-right: 1%;
        margin-top: 12vh;
        margin-bottom: 1%;
        padding: 20px;
        font-family: Arial, sans-serif;
      }

      .datacontainer h1 {
        font-size: 2.8rem;
        margin-bottom: 20px;
      }

      .datacontainer h2 {
        font-size: 1.4rem;
        margin-top: 15px;
        margin-bottom: 10px;
      }

      .datacontainer h3 {
        font-size: 1.2rem;
        margin-top: 10px;
        margin-bottom: 5px;
      }

      .datacontainer ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .datacontainer li {
        margin-bottom: 5px;
      }

      .data-section h2 {
        font-size: 1.8rem; /* Increase the font size for h2 */
      }

      .data-section h3 {
        font-size: 1.4rem; /* Increase the font size for h3 */
      }

      .data-section ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .data-section li {
        font-size: 1.2rem; /* Increase the font size for li */
        margin-bottom: 5px;
      }

      .date-input-container {
        display: flex;
        align-items: center; /* Vertically center items */
        gap: 10px; /* Space between items */
      }

      #dateForm label {
        display: block;
        margin-bottom: 5px;
      }

      #dateForm input[type="date"] {
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      #dateForm input[type="submit"] {
        padding: 8px 15px;
        background-color: #374785;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      #dateForm input[type="submit"]:hover {
        background-color: #293961;
      }

      #dataTable {
        width: 100%;
        margin-top: 20px;
        border-collapse: separate;
        border-spacing: 1px;
      }

      #dataTable th,
      #dataTable td {
        border: none; /* Adjust border style if needed */
        padding: 8px;
        text-align: center;
        border-radius: 3px;
      }

      #dataTable th {
        background-color: #374785;
        color: white;
      }

      #dataTable tr {
        background-color: #f5f5f5; /* Alternate row background color */
      }

      #dataTable tr:nth-child(even) {
        background-color: #e0e0e0; /* Even row background color */
      }
    </style>
  </head>
  <body>
    <div class="horizontalnavbar">
      <div class="left-section">
        <img
          src="{{ url_for('static', filename='images/mmmlogo.jpeg') }}"
          alt="MMM logo"
          class="logo-image"
          width="80"
          height="80"
        />
        <h3>MMM Hall of Residence</h3>
      </div>
      <div class="right-section">
        <h3>IIT Kharagpur</h3>
        <img
          src="{{ url_for('static', filename='images/iit-kharagpur.png') }}"
          alt="IIT KGP logo"
          class="logo-image"
          width="80"
          height="80"
        />
      </div>
    </div>

    <div>
      <ul class="verticalnavbar">
        <h1>Mess Management</h1>
        {% for item in navbard %}
        <li>
          <a href="{{ item.url }}">{{ item.label }}</a>
        </li>
        {% endfor %}
      </ul>
    </div>

    <div class="datacontainer">
      <h1>Home Page</h1>
      <div class="data-section">
        <h2>Total Number of Students: {{ data.total_students }}</h2>
        <h3>Total Food Consumption</h3>
        <ul>
          <li>Breakfast: {{ data.breakfast_total }}</li>
          <li>Lunch: {{ data.lunch_total }}</li>
          <li>Snacks: {{ data.snacks_total }}</li>
          <li>Dinner: {{ data.dinner_total }}</li>
          <li>Total food consumed: {{ data.total_food_consumed }}</li>
        </ul>
      </div>
      <div class="date-range-section">
        <h2>Date Range</h2>
        <form id="dateForm" method="POST">
          <div class="date-input-container">
            <label for="start_date">Start Date:</label>
            <input type="date" id="start_date" name="start_date" required />
            <label for="end_date">End Date:</label>
            <input type="date" id="end_date" name="end_date" required />
            <input type="submit" value="Submit" />
          </div>
        </form>
      </div>

      <div class="table-section">
        <table id="dataTable">
          <thead>
            <tr>
              <th>Day</th>
              <th>Breakfast</th>
              <th>Lunch</th>
              <th>Snacks</th>
              <th>Dinner</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <!-- Table data will be populated dynamically from the backend response -->
          </tbody>
        </table>
      </div>
    </div>
    <script>
      const dateForm = document.getElementById("dateForm");
      const dataTableBody = document.querySelector("#dataTable tbody");
      const startDateInput = document.getElementById("start_date");
      const endDateInput = document.getElementById("end_date");
      startDateInput.value = "2023-01-01"; // January 1, 2023
      endDateInput.value = "2023-12-31";

      // Fetch data on page load and populate the table
      fetchData();

      dateForm.addEventListener("submit", async (event) => {
        event.preventDefault();

        const formData = new FormData(dateForm);
        const start_date = formData.get("start_date");
        const end_date = formData.get("end_date");

        try {
          const response = await fetch("/process_data", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: `start_date=${encodeURIComponent(
              start_date
            )}&end_date=${encodeURIComponent(end_date)}`,
          });

          const data = await response.json();

          // Clear existing table rows
          dataTableBody.innerHTML = "";

          // Add new rows based on the data from the backend
          for (const weekday in data.weekday_totals) {
            const row = document.createElement("tr");
            const weekdayData = data.weekday_totals[weekday];
            row.innerHTML = `
                        <td>${weekday}</td>
                        <td>${weekdayData.breakfast_total}</td>
                        <td>${weekdayData.lunch_total}</td>
                        <td>${weekdayData.snacks_total}</td>
                        <td>${weekdayData.dinner_total}</td>
                        <td>${
                          weekdayData.breakfast_total +
                          weekdayData.lunch_total +
                          weekdayData.snacks_total +
                          weekdayData.dinner_total
                        }</td>
                    `;
            dataTableBody.appendChild(row);
          }
        } catch (error) {
          console.error("Error:", error);
        }
      });

      function getDayOfWeek(weekday) {
        const daysOfWeek = [
          "Sunday",
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Friday",
          "Saturday",
        ];
        return daysOfWeek[weekday];
      }

      async function fetchData() {
        const start_date = startDateInput.value;
        const end_date = endDateInput.value;

        try {
          const response = await fetch("/process_data", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: `start_date=${encodeURIComponent(
              start_date
            )}&end_date=${encodeURIComponent(end_date)}`,
          });

          const data = await response.json();

          // Clear existing table rows
          dataTableBody.innerHTML = "";

          // Add new rows based on the data from the backend
          for (const weekday in data.weekday_totals) {
            const row = document.createElement("tr");
            const weekdayData = data.weekday_totals[weekday];
            row.innerHTML = `
                        <td>${weekday}</td>
                        <td>${weekdayData.breakfast_total}</td>
                        <td>${weekdayData.lunch_total}</td>
                        <td>${weekdayData.snacks_total}</td>
                        <td>${weekdayData.dinner_total}</td>
                        <td>${
                          weekdayData.breakfast_total +
                          weekdayData.lunch_total +
                          weekdayData.snacks_total +
                          weekdayData.dinner_total
                        }</td>
                    `;
            dataTableBody.appendChild(row);
          }
        } catch (error) {
          console.error("Error:", error);
        }
      }
    </script>
  </body>
</html>

<!DOCTYPE html>
<html>
  <head>
    <title>Text Box Example</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <style>
      /* Body styles */
      .horizontalnavbar {
        background-color: #374785;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        width: 100%;
        position: fixed; /* Fix the navbar */
        top: 0; /* Position it at the top */
        left: 0; /* Align it to the left */
        z-index: 1000; /* Set a higher z-index to ensure it's above other elements */
      }

      .left-section,
      .right-section {
        display: flex;
        align-items: center;
      }

      .logo-image {
        margin-right: 10px;
      }

      .logo-image,
      h2,
      h3 {
        font-family: "Arial", sans-serif;
      }

      .horizontalnavbar h2 {
        font-size: 1.2rem;
        margin: 0;
      }

      .horizontalnavbar h3 {
        margin: 0;
        left: 40px;
      }

      .horizontalnavbar a {
        color: white;
        text-decoration: none;
        transition: color 0.3s;
      }

      .horizontalnavbar a:hover {
        color: #ffd700;
      }

      .verticalnavbar {
        background-color: #2c3e50;
        color: white;
        width: 20%;
        position: fixed; /* Fixed positioning */
        top: 70px; /* Stick to the top of the viewport */
        bottom: 0px; /* Take up the full height of the viewport */
        padding: 25px;
        box-shadow: 2px 0px 5px rgba(0, 0, 0, 0.2); /* Add a shadow for a better look */
      }

      .verticalnavbar h1 {
        font-size: 1.5rem;
        margin-bottom: 20px;
      }

      .verticalnavbar ul {
        list-style: none;
        padding: 0;
      }

      .verticalnavbar li {
        margin-bottom: 10px;
      }

      .verticalnavbar a {
        color: white;
        text-decoration: none;
        transition: color 0.3s;
      }

      .verticalnavbar a:hover {
        color: #ffd700; /* Hover color */
      }

      /* General styling for container */
      .datacontainer {
        background-color: #ffffff;
        margin-left: 20%;
        padding: 20px;
        font-family: Arial, sans-serif;
      }
      .datacontainer {
        background-color: #ffffff;
        margin-left: 20%;
        padding: 20px;
        font-family: Arial, sans-serif;
      }

      .datacontainer h1 {
        font-size: 1.8rem;
        margin-bottom: 20px;
      }

      .datacontainer .formentry {
        margin-top: 20px;
      }

      .datacontainer label {
        display: block;
        margin-bottom: 5px;
      }

      .datacontainer input[type="text"],
      .datacontainer input[type="date"],
      .datacontainer select {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      .datacontainer input[type="submit"] {
        padding: 10px 15px;
        background-color: #374785;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .datacontainer input[type="submit"]:hover {
        background-color: #293961;
      }

      .datacontainer #response {
        font-size: 1.8rem;
        margin-top: 20px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <div class="horizontalnavbar">
      <div class="left-section">
        <img
          src="{{ url_for('static', filename='images/mmmlogo.jpeg') }}"
          alt="MMM logo"
          class="logo-image"
          width="50"
          height="50"
        />
        <h3>MMM Hall of Residence</h3>
      </div>
      <div class="right-section">
        <h2><a href="/logout">Logout</a></h2>
        <img
          src="{{ url_for('static', filename='images/iit-kharagpur.png') }}"
          alt="IIT KGP logo"
          class="logo-image"
          width="50"
          height="50"
        />
      </div>
    </div>
    <div>
      <ul class="verticalnavbar">
        <h1>mess management</h1>
        {% for item in navbard %}
        <li><a href="{{ item.url }}">{{ item.label }}</a></li>
        {% endfor %}
      </ul>
    </div>

    <div class="datacontainer">
      <h1>student entry</h1>
      <form id="textBoxForm" class="formentry">
        <label for="userInput">Enter Roll Number</label>
        <input type="text" id="userInput" name="userInput" autofocus /><br />

        <label for="dateInput">Select Date:</label>
        <input type="date" id="dateInput" name="dateInput" /><br />

        <label for="mealSelect">Select Meal:</label>
        <select id="mealSelect" name="mealSelect">
          <option value="breakfast">Breakfast</option>
          <option value="lunch">Lunch</option>
          <option value="snacks">Snacks</option>
          <option value="dinner">Dinner</option></select
        ><br />

        <input type="submit" value="Submit" id="submitButton" />
      </form>

      <div id="response">
        <!-- Display the response from the Flask backend here -->
      </div>
    </div>
    <script>
      const today = new Date().toISOString().split("T")[0]; // Get today's date in YYYY-MM-DD format
      document.getElementById("dateInput").value = today;

      const textBoxForm = document.getElementById("textBoxForm");
      const responseDiv = document.getElementById("response");
      const submitButton = document.getElementById("submitButton");
      let savedDateValue = today;
      let savedMealValue = "breakfast";

      textBoxForm.addEventListener("submit", async (event) => {
        event.preventDefault();
        submitButton.disabled = true; // Disable the submit button
        const formData = new FormData(textBoxForm);
        const userInputValue = formData.get("userInput");
        const dateInputValue = formData.get("dateInput");
        const mealSelectValue = formData.get("mealSelect");
        console.log(dateInputValue, mealSelectValue);
        try {
          const response = await fetch("/process_text", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: `userInput=${encodeURIComponent(
              userInputValue
            )}&dateInput=${encodeURIComponent(
              dateInputValue
            )}&mealSelect=${encodeURIComponent(mealSelectValue)}`,
          });

          const data = await response.json();
          if (data.name && data.roll_no) {
            responseDiv.innerHTML = `Name: ${data.name}<br> roll number: ${data.roll_no}<br> category: ${data.category}`;
            responseDiv.style.color = "green";
          } else if (data.error) {
            responseDiv.innerHTML = `${data.error}`;
            responseDiv.style.color = "red";
          }

          // Save date and dropdown values
          savedText = "";
          savedDateValue = dateInputValue;
          savedMealValue = mealSelectValue;
        } catch (error) {
          console.error("Error:", error);
          responseDiv.textContent = "An error occurred. Please try again.";
        } finally {
          // Restore date and dropdown values
          document.getElementById("userInput").value = savedText;
          document.getElementById("dateInput").value = savedDateValue;
          document.getElementById("mealSelect").value = savedMealValue;

          submitButton.disabled = false; // Enable the submit button
        }
      });
    </script>
  </body>
</html>

<!DOCTYPE html>
<html>
  <head>
    <title>Consumption page</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <style>
      /* Body styles */
      .horizontalnavbar {
        background-color: #374785;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        width: 100%;
        position: fixed; /* Fix the navbar */
        top: 0; /* Position it at the top */
        left: 0; /* Align it to the left */
        z-index: 1000; /* Set a higher z-index to ensure it's above other elements */
      }
      
      .left-section,
      .right-section {
        display: flex;
        align-items: center;
      }
      
      .logo-image {
        margin-right: 10px;
      }
      
      .logo-image,
      h2,
      h3 {
        font-family: "Arial", sans-serif;
      }
      
      .horizontalnavbar h2 {
        font-size: 1.2rem;
        margin: 0;
      }
      
      .horizontalnavbar h3 {
        margin: 0;
        left: 40px;
      }
      
      .horizontalnavbar a {
        color: white;
        text-decoration: none;
        transition: color 0.3s;
      }
      
      .horizontalnavbar a:hover {
        color: #ffd700;
      }

      .verticalnavbar {
        background-color: #2c3e50;
        color: white;
        width: 20%;
        position: fixed; /* Fixed positioning */
        top: 70px; /* Stick to the top of the viewport */
        bottom: 0px; /* Take up the full height of the viewport */
        padding: 25px;
        box-shadow: 2px 0px 5px rgba(0, 0, 0, 0.2); /* Add a shadow for a better look */
      }

      .verticalnavbar h1 {
        font-size: 1.5rem;
        margin-bottom: 20px;
      }

      .verticalnavbar ul {
        list-style: none;
        padding: 0;
      }

      .verticalnavbar li {
        margin-bottom: 10px;
      }

      .verticalnavbar a {
        color: white;
        text-decoration: none;
        transition: color 0.3s;
      }

      .verticalnavbar a:hover {
        color: #ffd700; /* Hover color */
      }

      .datacontainer {
        background-color: #ffffff;
        margin-left: 20%;
        padding: 20px;
        font-family: Arial, sans-serif;
      }
      
      .datacontainer h1 {
        font-size: 1.8rem;
        margin-bottom: 20px;
      }
      
      .datacontainer div {
        margin-bottom: 10px;
      }
      
      .dateinput label,
      .serchintable label {
        margin-right: 10px;
      }
      
      .dateinput input,
      .serchintable input {
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      .serchintable {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 10px;
      }
      
      .serchintable label,
      .serchintable input,
      .serchintable button {
        margin-bottom: 10px;
      }
      
      .dateinput button,
      .serchintable button {
        padding: 8px 15px;
        background-color: #374785;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }
      
      .dateinput button:hover,
      .serchintable button:hover {
        background-color: #293961;
      }
      

      .tablefordata {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
        font-size: 14px;
      }
      
      .tablefordata th,
      .tablefordata td {
        border: 1px solid #ccc;
        padding: 10px;
        text-align: center;
      }
      
      .tablefordata th {
        background-color: #374785;
        color: white;
      }
      
      .tablefordata tr:nth-child(even) {
        background-color: #f2f2f2;
      }
      
      .tablefordata tr:hover {
        background-color: #e6e6e6;
        transition: background-color 0.3s;
      }
      
      /* Styling for the button */
      .tablefordata button {
        padding: 8px 15px;
        background-color: #374785;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      
      .tablefordata button:hover {
        background-color: #293961;
      }
      
    </style>
  </head>
  <body>
    <div class="horizontalnavbar">
      <div class="left-section">
        <img
          src="{{ url_for('static', filename='images/mmmlogo.jpeg') }}"
          alt="MMM logo"
          class="logo-image"
          width="50"
          height="50"
        />
        <h3>MMM Hall of Residence</h3>
      </div>
      <div class="right-section">
        <h2><a href="/logout">Logout</a></h2>
        <img
          src="{{ url_for('static', filename='images/iit-kharagpur.png') }}"
          alt="IIT KGP logo"
          class="logo-image"
          width="50"
          height="50"
        />
      </div>
    </div>

    <div>
      <ul class="verticalnavbar">
        <h1>mess management</h1>
        {% for item in navbard %}
        <li><a href="{{ item.url }}">{{ item.label }}</a></li>
        {% endfor %}
      </ul>
    </div>

  <div class="datacontainer">
    <h1>Consumption List</h1>
    {% with messages = get_flashed_messages() %} {% if messages %} {% for
      message in messages %}
      <div>{{ message }}</div>
      {% endfor %} {% endif %} {% endwith %}
    <div class = "dateinput">
      <label for="start_date">Start Date:</label>
      <input type="date" id="start_date" name="start_date" required />
      <label for="end_date">End Date:</label>
      <input type="date" id="end_date" name="end_date" required />
      <button onclick="fetchData()">Submit</button>
    </div>
    <br />
    <div>
      <label for="search">Search:</label>
      <input
        type="text"
        id="search"
        name="search"
        oninput="searchData()"
        placeholder="Search by Name or Roll Number or Amount"
      />
    </div>
    <br />
    <div class = "serchintable">
      <label for="amount1">Breakfast</label>
      <input type="number" id="amount1" oninput="filterAmount1()" />
      <label for="amount2">Lunch</label>
      <input type="number" id="amount2" oninput="filterAmount2()" />
      <label for="amount3">Snacks</label>
      <input type="number" id="amount3" oninput="filterAmount3()" />
      <label for="amount4">Dinner</label>
      <input type="number" id="amount4" oninput="filterAmount4()" />
      <label for="total">Total:</label>
      <input type="number" id="total" oninput="filterTotal()" />
    </div>
    <br />
    <table id="dataTable" class = "tablefordata">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Roll Number</th>
          <th>Weekday</th>
          <th>Breakfast</th>
          <th>Lunch</th>
          <th>Snacks</th>
          <th>Dinner</th>
          <th>Total</th>
          <th>View More</th>
        </tr>
      </thead>
      <tbody>
        <!-- Table data will be populated dynamically from the backend response -->
      </tbody>
    </table>
  </div>  
    <script>
      const start_date_input = document.getElementById("start_date");
      const end_date_input = document.getElementById("end_date");
      const search_input = document.getElementById("search");
      const amount1_input = document.getElementById("amount1");
      const amount2_input = document.getElementById("amount2");
      const amount3_input = document.getElementById("amount3");
      const amount4_input = document.getElementById("amount4");
      const total_input = document.getElementById("total");
      const dataTableBody = document.querySelector("#dataTable tbody");

      // Set default date values for the date inputs
      start_date_input.value = "2023-01-01"; // January 1, 2023
      end_date_input.value = "2023-12-31";

      let dataFetched = false;

      window.onload = function () {
        // Call fetchData() only once when the page is loaded
        if (!dataFetched) {
          fetchData();
          dataFetched = true;
        }
      };

      async function fetchData() {
        const start_date = start_date_input.value;
        const end_date = end_date_input.value;

        const response = await fetch(
          `/consumption_data?start_date=${start_date}&end_date=${end_date}`
        );
        const data = await response.json();
        populateTable(data);
        console.log(data);
      }

      function populateTable(data) {
        dataTableBody.innerHTML = "";
        const days = [
          "Sunday",
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Friday",
          "Saturday",
        ];
        for (const row of data.rows) {
          const tr = document.createElement("tr");
          tr.innerHTML = `
                    <td>${row.student_id}</td>
                    <td>${row.student_name}</td>
                    <td>${row.roll_number}</td>
                    <td>${days[row.weekday]}</td>
                    <td>${row.amount1}</td>
                    <td>${row.amount2}</td>
                    <td>${row.amount3}</td>
                    <td>${row.amount4}</td>
                    <td>${row.total}</td>
                    <td><button onclick="viewMore(${
                      row.student_id
                    })">View More</button></td>
                `;
          dataTableBody.appendChild(tr);
        }
      }

      function viewMore(id) {
        window.location.href = `/personal?id=${id}`;
      }

      function searchData() {
        const start_date = start_date_input.value;
        const end_date = end_date_input.value;
        const searchValue = search_input.value.toLowerCase();

        const rows = dataTableBody.getElementsByTagName("tr");

        for (const row of rows) {
          const rowName = row.cells[1].textContent.toLowerCase();
          const rowRollNumber = row.cells[2].textContent.toLowerCase();

          if (
            rowName.includes(searchValue) ||
            rowRollNumber.includes(searchValue)
          ) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        }
      }

      function filterAmount1() {
        const amount1 = parseInt(amount1_input.value);

        const rows = dataTableBody.getElementsByTagName("tr");

        for (const row of rows) {
          const rowAmount1 = parseInt(row.cells[3].textContent);

          if (amount1 && rowAmount1 <= amount1) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        }
      }

      function filterAmount2() {
        const amount2 = parseInt(amount2_input.value);

        const rows = dataTableBody.getElementsByTagName("tr");

        for (const row of rows) {
          const rowAmount2 = parseInt(row.cells[4].textContent);

          if (amount2 && rowAmount2 <= amount2) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        }
      }

      function filterAmount3() {
        const amount3 = parseInt(amount3_input.value);

        const rows = dataTableBody.getElementsByTagName("tr");

        for (const row of rows) {
          const rowAmount3 = parseInt(row.cells[5].textContent);

          if (amount3 && rowAmount3 <= amount3) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        }
      }

      function filterAmount4() {
        const amount4 = parseInt(amount4_input.value);

        const rows = dataTableBody.getElementsByTagName("tr");

        for (const row of rows) {
          const rowAmount4 = parseInt(row.cells[6].textContent);

          if (amount4 && rowAmount4 <= amount4) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        }
      }

      function filterTotal() {
        const total = parseInt(total_input.value);

        const rows = dataTableBody.getElementsByTagName("tr");

        for (const row of rows) {
          const rowTotal = parseInt(row.cells[7].textContent);

          if (total && rowTotal <= total) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        }
      }
    </script>
  </body>
</html>
